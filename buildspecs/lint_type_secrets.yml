version: 0.2

env:
  variables:
    NPM_CONFIG_PRODUCTION: "false"

phases:
  install:
    runtime-versions:
      nodejs: 20
    commands:
      - echo "Installing dependencies..."
      - npm ci --prefer-offline --no-progress
      - wget https://github.com/gitleaks/gitleaks/releases/download/v8.18.0/gitleaks_8.18.0_linux_x64.tar.gz
      - tar -xzf gitleaks_8.18.0_linux_x64.tar.gz
      - chmod +x gitleaks
      - mv gitleaks /usr/local/bin/

  build:
    commands:
      - echo "Running lint..."
      - npm run lint || echo "⚠️ Lint failed, continuing (fix errors for production)"
      - echo "Running type check..."
      - npx tsc --noEmit || echo "⚠️ Type check failed, continuing"
      - echo "Scanning for secrets..."
      - ./gitleaks detect --source . --no-git || echo "⚠️ Secret scan completed"

artifacts:
  files:
    - "**/*"
  name: LintTypeSecretsOutput

cache:
  paths:
    - "~/.npm/**/*"

